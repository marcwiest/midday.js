<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>midday.js — Demo</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>

  <header data-midday-element="top">
    <nav>
      <div class="logo">midday.js</div>
      <ul>
        <li><a href="#hero">Home</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#work">Work</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><button class="dropdown-trigger">More &#9662;</button></li>
      </ul>
    </nav>
  </header>

  <div class="dropdown-panel" id="dropdown-panel">
    <a href="#hero">Home</a>
    <a href="#about">About</a>
    <a href="#work">Work</a>
    <a href="#contact">Contact</a>
  </div>

  <nav class="dock">
    <div class="dock-variant" id="dock-default">
      <span class="dock-label">Default</span>
      <span class="dock-progress-text" id="progress-default">0%</span>
    </div>
    <div class="dock-variant" id="dock-dark" aria-hidden="true" inert>
      <span class="dock-label">Dark</span>
      <span class="dock-progress-text" id="progress-dark">0%</span>
    </div>
    <div class="dock-variant" id="dock-accent" aria-hidden="true" inert>
      <span class="dock-label">Accent</span>
    </div>
    <div class="dock-variant" id="dock-inverted" aria-hidden="true" inert>
      <span class="dock-icon">&#9670;</span>
      <span class="dock-label">Inverted</span>
      <span class="dock-icon">&#9670;</span>
    </div>
    <div class="dock-variant" id="dock-expanded" aria-hidden="true" inert>
      <span class="dock-label">Expanded Dock</span>
      <span class="dock-icon">&#9679;</span>
      <span class="dock-label">Different Height</span>
    </div>
  </nav>

  <section id="hero" class="hero" data-midday-section="dark">
    <h2>Hero Section</h2>
    <p>Both header and dock use the "dark" variant here (no target — applies to all).</p>
  </section>

  <section id="about" class="content">
    <h2>About Section</h2>
    <p>No data-midday-section attribute — both bars fall back to their "default" variant.</p>
  </section>

  <section class="accent-section" data-midday-section="accent" data-midday-target="top bottom">
    <h2>Accent Section</h2>
    <p>Only the top header changes to "accent" here. The bottom dock stays default (target="top").</p>
  </section>

  <section class="light-section">
    <h2>Light Section</h2>
    <p>No variant specified. Both bars return to default.</p>
  </section>

  <section class="dark-section" data-midday-section="inverted" data-midday-target="top bottom">
    <h2>Inverted Section</h2>
    <p>Both bars change to "inverted" — targeting both explicitly (target="top bottom").</p>
  </section>

  <section id="work" class="content">
    <h2>Work Section</h2>
    <p>Back to the default variant again. Scroll up and down to see the transitions.</p>
  </section>

  <section class="hero" data-midday-section="dark" data-midday-target="bottom">
    <h2>Bottom-only Dark Section</h2>
    <p>Only the bottom dock changes to "dark" here. The top header stays default (target="bottom").</p>
  </section>

  <section id="contact" class="expanded-section" data-midday-section="expanded" data-midday-target="top bottom">
    <h2>Expanded Section</h2>
    <p>Both bars use "expanded" — the dock variant is taller than its container, with extra height revealed as the section scrolls past.</p>
  </section>

  <script type="module">
    import { midday, middayHeadless } from '../src/index.ts';

    const progressDefault = document.getElementById('progress-default');
    const progressDark = document.getElementById('progress-dark');

    midday(document.querySelector('[data-midday-element="top"]'), {
      onChange: (variants) => {
        console.log('Top (auto):', variants);
      },
    });

    middayHeadless({
      header: document.querySelector('.dock'),
      variants: {
        default: document.getElementById('dock-default'),
        dark: document.getElementById('dock-dark'),
        accent: document.getElementById('dock-accent'),
        inverted: document.getElementById('dock-inverted'),
        expanded: document.getElementById('dock-expanded'),
      },
      name: 'bottom',
      onChange: (variants) => {
        console.log('Bottom (headless):', variants);
        const def = variants.find((v) => v.name === 'default');
        const dark = variants.find((v) => v.name === 'dark');
        progressDefault.textContent = def ? `${Math.round(def.progress * 100)}%` : '0%';
        progressDark.textContent = dark ? `${Math.round(dark.progress * 100)}%` : '0%';
      },
    });
    // Header click delegation with coordinate fallback.
    //
    // Clone variants have pointer-events: none + inert, and the default
    // variant's clip-path blocks hit-testing when it's clipped. Clicks in
    // the header area still fire on document (targeting the <header> itself),
    // so we match click coordinates against interactive element rects.
    const header = document.querySelector('[data-midday-element="top"]');
    const panel = document.getElementById('dropdown-panel');

    function hitTest(e, selector) {
      for (const el of header.querySelectorAll(selector)) {
        const r = el.getBoundingClientRect();
        if (r.width > 0 &&
            e.clientX >= r.left && e.clientX <= r.right &&
            e.clientY >= r.top && e.clientY <= r.bottom) {
          return el;
        }
      }
      return null;
    }

    function toggleDropdown(rect) {
      panel.style.top = rect.bottom + 4 + 'px';
      panel.style.right = (window.innerWidth - rect.right) + 'px';
      panel.classList.toggle('open');
    }

    document.addEventListener('click', (e) => {
      if (panel.contains(e.target)) return;

      // Direct click (works when default variant is visible)
      const directTrigger = e.target.closest('.dropdown-trigger');
      if (directTrigger) {
        toggleDropdown(directTrigger.getBoundingClientRect());
        return;
      }
      const directLink = e.target.closest('header a');
      if (directLink) return; // browser handles it natively

      // Coordinate fallback for clone variants
      const trigger = hitTest(e, '.dropdown-trigger');
      if (trigger) {
        toggleDropdown(trigger.getBoundingClientRect());
        return;
      }
      const link = hitTest(e, 'a[href]');
      if (link) {
        panel.classList.remove('open');
        window.location.href = link.href;
        return;
      }

      panel.classList.remove('open');
    });
  </script>

</body>
</html>
